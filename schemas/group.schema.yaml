$schema: "https://json-schema.org/draft/2020-12/schema"
title: "Group Manifest v2"
type: object
required:
  - schema_version
  - group_id
  - display_name
  - template_version
  - domain
  - purpose
  - success_criteria
  - head
  - specialists
  - required_artifacts
  - gate_profile
  - tool_profile
  - default_workdirs
  - quality_gates
properties:
  schema_version:
    type: string
    const: "2.0"
  group_id:
    type: string
    pattern: "^[a-z0-9-]+$"
  display_name:
    type: string
    minLength: 3
  template_version:
    type: string
  domain:
    type: string
  purpose:
    type: string
    minLength: 8
  success_criteria:
    type: array
    minItems: 1
    items:
      type: string
      minLength: 3
  head:
    type: object
    required: [agent_id, skill_name, mission, publish_contract]
    properties:
      agent_id: {type: string}
      skill_name: {type: string}
      mission: {type: string}
      publish_contract:
        type: object
        required: [exposed_required, visibility]
        properties:
          exposed_required:
            type: array
            minItems: 1
            items: {type: string}
          visibility:
            type: string
            enum: [group-only, full]
  specialists:
    type: array
    minItems: 4
    items:
      type: object
      required:
        - agent_id
        - skill_name
        - role
        - focus
        - contract
        - depends_on
        - required_references
        - required_outputs
      properties:
        agent_id: {type: string}
        skill_name: {type: string}
        role: {type: string}
        focus: {type: string}
        required_references:
          type: array
          minItems: 1
          items: {type: string}
        required_outputs:
          type: array
          minItems: 1
          items: {type: string}
        contract:
          type: object
          required: [inputs, outputs, output_schema]
          properties:
            inputs:
              type: array
              minItems: 1
              items: {type: string}
            outputs:
              type: array
              minItems: 1
              items: {type: string}
            output_schema:
              type: string
        depends_on:
          type: array
          items:
            type: object
            required: [agent_id, required_artifacts, validate_with, on_missing]
            properties:
              agent_id: {type: string}
              required_artifacts:
                type: array
                minItems: 1
                items: {type: string}
              validate_with:
                type: string
                pattern: "^(exists|json-parse|schema:[A-Za-z0-9._-]+)$"
              on_missing:
                type: string
                enum: [request-rerun, regenerate, block]
        execution:
          type: object
          properties:
            remote_transport:
              type: string
              enum: [local, ssh]
            scheduler:
              type: string
            hardware:
              type: string
            requires_gpu:
              type: boolean
  required_artifacts:
    type: object
  gate_profile:
    type: object
    required: [profile_id, specialist_output_schema, checks]
    properties:
      profile_id: {type: string}
      specialist_output_schema: {type: string}
      checks:
        type: object
        additionalProperties: {type: boolean}
  tool_profile:
    type: string
  interaction:
    type: object
    properties:
      mode:
        type: string
        enum: [interactive-separated]
      linked_groups:
        type: array
        items: {type: string}
  execution_defaults:
    type: object
    properties:
      remote_transport:
        type: string
        enum: [local, ssh]
      schedulers:
        type: array
        items: {type: string}
      hardware:
        type: array
        items: {type: string}
  default_workdirs:
    type: array
    minItems: 1
    items: {type: string}
  quality_gates:
    type: object
    required:
      - citation_required
      - unresolved_claims_block
      - peer_check_required
      - consistency_required
      - scope_required
      - reproducibility_required
    properties:
      citation_required: {type: boolean}
      unresolved_claims_block: {type: boolean}
      peer_check_required: {type: boolean}
      consistency_required: {type: boolean}
      scope_required: {type: boolean}
      reproducibility_required: {type: boolean}
additionalProperties: true
