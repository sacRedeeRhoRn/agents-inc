$schema: "https://json-schema.org/draft/2020-12/schema"
title: "Dispatch Plan v2"
type: object
required:
  - project_id
  - group_id
  - objective
  - dispatch_mode
  - session_mode
  - phases
  - gate_profile
  - specialist_output_schema
  - locking
properties:
  project_id: {type: string}
  group_id: {type: string}
  objective: {type: string}
  dispatch_mode:
    type: string
    enum: [hybrid]
  session_mode:
    type: string
    enum: [interactive-separated]
  specialist_output_schema:
    type: string
  gate_profile:
    type: object
  phases:
    type: array
    minItems: 1
    items:
      type: object
      required: [phase_id, mode, tasks]
      properties:
        phase_id: {type: integer}
        mode:
          type: string
          enum: [parallel, sequential]
        tasks:
          type: array
          minItems: 1
          items:
            type: object
            required: [agent_id, role, focus, skill_name, workdir]
            properties:
              agent_id: {type: string}
              role: {type: string}
              focus: {type: string}
              skill_name: {type: string}
              workdir: {type: string}
              transport:
                type: string
                enum: [local, ssh]
              scheduler: {type: string}
              hardware: {type: string}
              requires_gpu: {type: boolean}
              depends_on:
                type: array
                items: {type: object}
              dependency_checks:
                type: array
                items: {type: object}
  locking:
    type: object
    required: [mode, backend, available]
    properties:
      mode:
        type: string
        enum: [required, auto, off]
      backend:
        type: string
      available:
        type: boolean
      note:
        type: string
  quality_gates:
    type: object
    additionalProperties: {type: boolean}
additionalProperties: true
